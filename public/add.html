<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ajouter une recette - RecipeBook</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-3xl">
        <!-- Header -->
        <header class="mb-8">
            <a href="/" class="text-orange-600 hover:text-orange-700 mb-4 inline-block">
                <i class="fas fa-arrow-left mr-2"></i> Retour à l'accueil
            </a>
            <h1 class="text-3xl font-bold text-gray-800">
                <i class="fas fa-plus-circle text-orange-500 mr-3"></i>Ajouter une recette
            </h1>
        </header>

        <!-- Formulaire -->
        <div class="bg-white rounded-xl shadow p-6">
            <form id="recipeForm">
                <!-- Titre -->
                <div class="mb-6">
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fas fa-heading mr-2"></i>Titre de la recette *
                    </label>
                    <input type="text" 
                           id="title"
                           required
                           class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                           placeholder="Ex: Gâteau au chocolat">
                </div>

                <!-- Description -->
                <div class="mb-6">
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fas fa-align-left mr-2"></i>Description *
                    </label>
                    <textarea 
                        id="description"
                        required
                        rows="3"
                        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                        placeholder="Décrivez brièvement votre recette..."></textarea>
                </div>

                <!-- Ingrédients -->
                <div class="mb-6">
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fas fa-carrot mr-2"></i>Ingrédients *
                    </label>
                    <div id="ingredientsContainer" class="space-y-2 mb-3">
                        <!-- Ingrédients ajoutés dynamiquement -->
                    </div>
                    <div class="flex">
                        <input type="text" 
                               id="ingredientInput"
                               class="flex-1 p-3 border rounded-l-lg"
                               placeholder="Ex: 200g de farine">
                        <button type="button" 
                                onclick="addIngredient()"
                                class="bg-gray-200 px-4 rounded-r-lg hover:bg-gray-300">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <p class="text-sm text-gray-500 mt-2">Appuyez sur Entrée ou cliquez sur + pour ajouter</p>
                </div>

                <!-- Instructions -->
                <div class="mb-6">
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fas fa-list-ol mr-2"></i>Instructions *
                    </label>
                    <textarea 
                        id="instructions"
                        required
                        rows="6"
                        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                        placeholder="Étapes de préparation..."></textarea>
                </div>

                <!-- Informations additionnelles -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">
                            <i class="fas fa-clock mr-2"></i>Temps de préparation (min)
                        </label>
                        <input type="number" 
                               id="prepTime"
                               min="1"
                               value="15"
                               class="w-full p-3 border rounded-lg">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">
                            <i class="fas fa-chart-line mr-2"></i>Difficulté
                        </label>
                        <select id="difficulty" class="w-full p-3 border rounded-lg">
                            <option value="facile">Facile</option>
                            <option value="moyen">Moyen</option>
                            <option value="difficile">Difficile</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">
                            <i class="fas fa-tag mr-2"></i>Catégorie
                        </label>
                        <select id="category" class="w-full p-3 border rounded-lg">
                            <option value="plat">Plat</option>
                            <option value="entrée">Entrée</option>
                            <option value="dessert">Dessert</option>
                            <option value="boisson">Boisson</option>
                            <option value="autre">Autre</option>
                        </select>
                    </div>
                </div>

                <!-- Image URL (optionnel) -->
                <div class="mb-8">
                    <label class="block text-gray-700 font-medium mb-2">
                        <i class="fas fa-image mr-2"></i>Image (URL)
                    </label>
                    <input type="url" 
                           id="image"
                           class="w-full p-3 border rounded-lg"
                           placeholder="https://exemple.com/image.jpg">
                </div>

                <!-- Boutons -->
                <div class="flex justify-end space-x-4">
                    <button type="button" 
                            onclick="window.location.href='/'" 
                            class="px-6 py-3 border rounded-lg hover:bg-gray-50">
                        Annuler
                    </button>
                    <button type="submit" 
                            class="bg-orange-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-orange-600">
                        <i class="fas fa-save mr-2"></i>Enregistrer la recette
                    </button>
                </div>
            </form>
        </div>

        <!-- Message de confirmation -->
        <div id="successMessage" class="hidden mt-6 p-4 bg-green-100 text-green-800 rounded-lg">
            <i class="fas fa-check-circle mr-2"></i> Recette ajoutée avec succès !
        </div>
    </div>

    <!-- Scripts -->
    <script src="/js/api.js"></script>
    
    <script>
        let ingredients = [];
        
        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            setupForm();
            setupIngredientInput();
        });

        function setupForm() {
            const form = document.getElementById('recipeForm');
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                // Récupérer les données du formulaire
                const recipeData = {
                    title: document.getElementById('title').value,
                    description: document.getElementById('description').value,
                    ingredients: ingredients,
                    instructions: document.getElementById('instructions').value,
                    prepTime: parseInt(document.getElementById('prepTime').value),
                    difficulty: document.getElementById('difficulty').value,
                    category: document.getElementById('category').value,
                    image: document.getElementById('image').value
                };
                
                // Validation basique
                if (ingredients.length === 0) {
                    alert('Ajoutez au moins un ingrédient');
                    return;
                }
                
                try {
                    // Envoyer à l'API
                    const newRecipe = await RecipeAPI.create(recipeData);
                    
                    // Afficher message de succès
                    document.getElementById('successMessage').classList.remove('hidden');
                    
                    // Rediriger après 2 secondes
                    setTimeout(() => {
                        window.location.href = `/recipe.html?id=${newRecipe._id}`;
                    }, 2000);
                    
                } catch (error) {
                    console.error('Erreur:', error);
                    alert('Erreur lors de l\'ajout de la recette');
                }
            });
        }

        function setupIngredientInput() {
            const input = document.getElementById('ingredientInput');
            
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addIngredient();
                }
            });
        }

        function addIngredient() {
            const input = document.getElementById('ingredientInput');
            const ingredient = input.value.trim();
            
            if (ingredient) {
                ingredients.push(ingredient);
                updateIngredientsDisplay();
                input.value = '';
                input.focus();
            }
        }

        function removeIngredient(index) {
            ingredients.splice(index, 1);
            updateIngredientsDisplay();
        }

        function updateIngredientsDisplay() {
            const container = document.getElementById('ingredientsContainer');
            let html = '';
            
            ingredients.forEach((ingredient, index) => {
                html += `
                    <div class="flex items-center bg-gray-50 p-2 rounded">
                        <span class="flex-1">${ingredient}</span>
                        <button type="button" 
                                onclick="removeIngredient(${index})"
                                class="text-red-500 hover:text-red-700 ml-2">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
            });
            
            container.innerHTML = html || '<p class="text-gray-500 text-sm">Aucun ingrédient ajouté</p>';
        }
    </script>
</body>
</html>